# ๐ง ุฅุตูุงุญ ูุดููุฉ ุงูุฃุฒุฑุงุฑ - ุงูุญู ุงูููุงุฆู

## โ ุงููุดููุฉ

ุงูุฃุฒุฑุงุฑ ูุง ุชุนูู ุจุณุจุจ **ุณูุงุณุงุช RLS** ูู Supabase. ุงูุณูุงุณุงุช ุงูุญุงููุฉ ุชุชุทูุจ `auth.uid()` ูู Supabase Authุ ููู ุงูุชุทุจูู ูุณุชุฎุฏู **Firebase Auth**.

---

## โ ุงูุญู ุงูุณุฑูุน (ุฏูููุฉ ูุงุญุฏุฉ)

### ุงูุฎุทูุฉ 1: ุงูุชุญ Supabase SQL Editor
1. ุงุฐูุจ ุฅูู: https://app.supabase.com
2. ุงูุชุญ ูุดุฑูุนู
3. ุงุฎุชุฑ **SQL Editor** ูู ุงููุงุฆูุฉ

### ุงูุฎุทูุฉ 2: ูููุฐ ุงูุณูุฑูุจุช
1. ุงูุชุญ ุงูููู: `database/fix_rls_policies.sql`
2. ุงูุณุฎ **ูู** ุงููุญุชูู
3. ุงูุตูู ูู SQL Editor
4. ุงุถุบุท **Run** (ุฃู Ctrl+Enter)

โฑ๏ธ **ุงูููุช:** 10 ุซูุงูู

---

## ๐ฏ ูุง ุงูุฐู ุณูุญุฏุซุ

### ุณูุชู:
- โ ุญุฐู ุงูุณูุงุณุงุช ุงููุฏููุฉ ุงูุชู ุชุนุชูุฏ ุนูู `auth.uid()`
- โ ุฅูุดุงุก ุณูุงุณุงุช ุฌุฏูุฏุฉ ุชุณูุญ ุจุฌููุน ุงูุนูููุงุช
- โ ุฅุถุงูุฉ ุญูู `age` ูููุชุจุฑุนูู
- โ ุชุญุฏูุซ ุฏุงูุฉ `record_donation`
- โ ุฅุถุงูุฉ ุฏุงูุฉ `days_until_next_donation`

### ุงููุชูุฌุฉ:
- โ ุฒุฑ "ุชุณุฌูู" ูููุชุจุฑุน ุณูุนูู
- โ ุฒุฑ "ุฅุฑุณุงู ุทูุจ ุงูุชุณุฌูู" ูููุณุชุดูู ุณูุนูู
- โ ุฒุฑ "ุฅุฑุณุงู ุงูุทูุจ" ูุทูุจ ุงูุฏู ุณูุนูู

---

## ๐งช ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญ

ุจุนุฏ ุชูููุฐ ุงูุณูุฑูุจุช:

### 1. ุชุณุฌูู ูุชุจุฑุน:
```
1. ุงูุชุญ ุงูุชุทุจูู
2. ุงุฎุชุฑ "ูุชุจุฑุน"
3. ุฃุฏุฎู ุฑูู ุงููุงุชู ูุงูู OTP
4. ุงููุฃ ุจูุงูุงุช ุงููุชุจุฑุน
5. ุงุถุบุท "ุชุณุฌูู"
โ ูุฌุจ ุฃู ูุนูู ุงูุขู!
```

### 2. ุชุณุฌูู ูุณุชุดูู:
```
1. ุงูุชุญ ุงูุชุทุจูู
2. ุงุฎุชุฑ "ูุณุชุดูู / ูุฑูุฒ ุตุญู"
3. ุฃุฏุฎู ุฑูู ุงููุงุชู ูุงูู OTP
4. ุงููุฃ ุจูุงูุงุช ุงููุณุชุดูู
5. ุงุถุบุท "ุฅุฑุณุงู ุทูุจ ุงูุชุณุฌูู"
โ ูุฌุจ ุฃู ูุนูู ุงูุขู!
```

### 3. ุฅูุดุงุก ุทูุจ ุฏู:
```
1. ุงูุชุญ ุงูุชุทุจูู
2. ุงุฎุชุฑ "ูุญุชุงุฌ ูุฏู"
3. ุฃุฏุฎู ุฑูู ุงููุงุชู ูุงูู OTP
4. ุงููุฃ ุชูุงุตูู ุงูุทูุจ
5. ุงุถุบุท "ุฅุฑุณุงู ุงูุทูุจ"
โ ูุฌุจ ุฃู ูุนูู ุงูุขู!
```

---

## ๐ ุงูุชุญูู ูู ุงููุฌุงุญ

### ูู Supabase Dashboard:

1. ุงุฐูุจ ุฅูู **Table Editor**
2. ุงูุชุญ ุฌุฏูู `donors` ุฃู `hospitals` ุฃู `blood_requests`
3. ูุฌุจ ุฃู ุชุฑู ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ ุงูุชู ุฃุฏุฎูุชูุง ูู ุงูุชุทุจูู

### ูู ุงูุชุทุจูู:

- ุฑุณุงูุฉ ูุฌุงุญ ุชุธูุฑ
- ุงูุงูุชูุงู ููุดุงุดุฉ ุงูุชุงููุฉ
- ูุง ุชูุฌุฏ ุฃุฎุทุงุก

---

## ๐ ููุงุฐุง ูุงูุช ุงููุดููุฉุ

### ุงูุณูุงุณุงุช ุงููุฏููุฉ:
```sql
CREATE POLICY "Authenticated users can create donor"
  ON donors FOR INSERT
  WITH CHECK (auth.uid()::text = user_id::text);
```
โ `auth.uid()` = `null` (ูุฃููุง ูุณุชุฎุฏู Firebase)

### ุงูุณูุงุณุงุช ุงูุฌุฏูุฏุฉ:
```sql
CREATE POLICY "Allow all operations on donors"
  ON donors FOR ALL
  USING (true)
  WITH CHECK (true);
```
โ ุชุณูุญ ุจุฌููุน ุงูุนูููุงุช

---

## ๐ก๏ธ ูู ูุฐุง ุขููุ

**ููุชุทููุฑ:** ูุนู โ
**ููุฅูุชุงุฌ:** ูุฌุจ ุชุญุณูู ุงูุฃูุงู ูุงุญูุงู

### ูู ุงููุณุชูุจู:
ููููู ุฅุถุงูุฉ ุฃูุงู ุฃูุถู ุจุงุณุชุฎุฏุงู:
- Service Role Key ููุนูููุงุช ุงูุญุณุงุณุฉ
- API Gateway ูุน Firebase Auth
- Supabase Edge Functions

---

## ๐ ููุงุญุธุงุช ูููุฉ

### Firebase Auth vs Supabase Auth:
- ุงูุชุทุจูู ูุณุชุฎุฏู **Firebase** ูููุตุงุฏูุฉ (OTP)
- Supabase ูุณุชุฎุฏู ููุท **ูุชุฎุฒูู ุงูุจูุงูุงุช**
- ูุฐูู `auth.uid()` ูู Supabase ุฏุงุฆูุงู `null`

### ุงูุญู ุงูุญุงูู:
- ููุงุณุจ ููุชุทููุฑ ูุงูุงุฎุชุจุงุฑ
- ูุณูุญ ุจุฌููุน ุงูุนูููุงุช ุนูู ุงูุฌุฏุงูู
- RLS ููุนูู ููู ุงูุณูุงุณุงุช ููุชูุญุฉ

---

## ๐ ุจุนุฏ ุงูุฅุตูุงุญ

ุงูุชุทุจูู ุงูุขู ูุนูู ุจุงููุงูู:
- โ ุชุณุฌูู ุงููุชุจุฑุนูู
- โ ุชุณุฌูู ุงููุณุชุดููุงุช
- โ ุฅูุดุงุก ุทูุจุงุช ุงูุฏู
- โ ุงูุจุญุซ ุนู ูุชุจุฑุนูู ูุชุทุงุจููู
- โ ุนุฑุถ ูุงุฆูุฉ ุงููุชุจุฑุนูู
- โ ุงูุชูุงุตู ูุน ุงููุชุจุฑุนูู

---

**ุฌุฑูุจ ุงูุชุทุจูู ุงูุขู! ูู ุดูุก ูุฌุจ ุฃู ูุนูู ุจุดูู ูุซุงูู ๐**
